#ifndef _SERIAL_PACKAGER_H_
#define _SERIAL_PACKAGER_H_

#include "system/includes.h"

/*************************************************************************************************/
/**
 * @brief   协议常量定义
 *************************************************************************************************/
#define SERIAL_PROTOCOL_HEADER_0     0xFE    /**< 协议头字节0 */
#define SERIAL_PROTOCOL_HEADER_1     0x55    /**< 协议头字节1 */
#define SERIAL_PROTOCOL_HEADER_2     0xAA    /**< 协议头字节2 */

/*************************************************************************************************/
/**
 * @brief   蓝牙命令类型枚举
 *************************************************************************************************/
typedef enum {
    BT_CMD_TYPE_REQUEST_WIHOUT_RSP  = 0x00,   /**< 0000 0000 命令包请求，不需要回复 */
    BT_CMD_TYPE_REQUEST_WITH_RSP  = 0x20,     /**< 0010 0000 命令包请求，需要回复 */
    BT_CMD_TYPE_RESPONSE = 0x40,              /**< 0100 0000 命令包回复，不需要回复 */
} bt_cmd_type_t;

/*************************************************************************************************/
/**
 * @brief   蓝牙数据类型枚举
 *************************************************************************************************/
typedef enum {
    BT_DATA_TYPE_REQUEST_WITHOUT_RSP  = 0x80, /**< 1000 0000 数据命令包，不需要回复 */
    BT_DATA_TYPE_REQUEST_WITH_RSP     = 0xA0, /**< 1010 0000 数据命令包，需要回复 */
    BT_DATA_TYPE_RESPONSE             = 0xC0, /**< 1100 0000 数据命令包回复，不需要回复 */
} bt_data_type_t;

/*************************************************************************************************/
/**
 * @brief   响应类型枚举
 *************************************************************************************************/
typedef enum {
    NO_RSP_CMD_TYPE_REQUEST  = 0x00,    /**< 0000 0000 收到从机发命令包请求，不需要回复 */
    RSP_CMD_TYPE_REQUEST  = 0x20,       /**< 0010 0000 收到从机发命令包请求，需要回复 */
    RSP_CMD_TYPE_RSP  = 0x40,           /**< 0100 0000 主机发命令，从机发命令包回复，不需要回复 */

    NO_RSP_DATA_TYPE_REQUEST = 0x80,    /**< 1000 0000 发数据命令包，不需要回复 */
    RSP_DATA_TYPE_REQUEST = 0xA0,       /**< 1010 0000 发或收到数据命令包，需要回复 */
    RSP_DATA_TYPE_RSP  = 0xC0,          /**< 1100 0000 收到数据命令包回复，不需要回复 */
} response_type_t;

/*************************************************************************************************/
/**
 * @brief   UART数据传输包解析错误码枚举
 *
 * @note    用于标识UART数据接收和解码过程中的各类错误状态
 *************************************************************************************************/
typedef enum {
    UART_ERR_SUCCESS      = 0x00, /**< 成功：操作顺利完成 */
    UART_ERR_FAILED       = 0x01, /**< 失败：通用错误代码，表示未指明的操作失败 */
    UART_ERR_UNDEFINED    = 0x02, /**< 未定义：遇到了未定义或未知的错误状态 */
    UART_ERR_BUSY         = 0x03, /**< 忙碌状态：设备或资源正忙，无法立即响应请求 */
    UART_ERR_NO_RESPONSE  = 0x04, /**< 没有收到回复：预期中的响应或确认信号未收到 */
    UART_ERR_CRC          = 0x05, /**< CRC出错：整个数据包的循环冗余校验失败 */
    UART_ERR_DATA_CRC     = 0x06, /**< 数据CRC出错：数据字段部分的CRC校验失败 */
    UART_ERR_PARAM_OVERFLOW = 0x07, /**< 参数溢出：接收到的参数值超出允许范围 */
    UART_ERR_DATA_OVERFLOW = 0x08, /**< 数据溢出：数据量超出缓冲区或预期长度 */
    UART_ERR_LRC          = 0x09,  /**< LRC获取出错：纵向冗余校验(LRC)计算或验证失败 */
    UART_ERR_LEN_ERROR     = 0x0A, /**< 长度错误：数据长度不符合预期 */
} UART_ErrorCode;

/*************************************************************************************************/
/**
 * @brief   命令协议包头结构体
 *
 * @note    使用1字节对齐打包
 *************************************************************************************************/
#pragma pack(1)
typedef struct {
    uint8_t header[3];    /**< FE 55 AA - 协议头 */
    uint8_t type;         /**< 命令类型 */
    uint8_t sn;           /**< 序列号 */
    uint16_t crc;         /**< CRC校验 */
    uint8_t code;         /**< 命令码 */
    uint16_t len;         /**< 长度（payload） */
    u8 *data;             /**< 有效数据指针 */
} cmd_send_header_t;

/*************************************************************************************************/
/**
 * @brief   命令协议包回复头结构体
 *
 * @note    使用1字节对齐打包
 *************************************************************************************************/
typedef struct {
    uint8_t header[3];    /**< FE 55 AA - 协议头 */
    uint8_t type;         /**< 命令类型 */
    uint8_t sn;           /**< 序列号 */
    uint16_t crc;         /**< CRC校验 */
    uint8_t code;         /**< 命令码 */
    uint16_t len;         /**< 长度（status + payload） */
    uint8_t cmd_status;   /**< 命令状态 */
    u8 *data;             /**< 有效数据指针 */
} cmd_response_header_t;
#pragma pack()

#endif /* _SERIAL_PACKAGER_H_ */

